provider "kubernetes" {
  config_path            = "~/.kube/config"
  config_context_cluster = "minikube"
  host                   = "https://192.168.49.2:8443"
}



resource "null_resource" "get_argocd_cm" {
  provisioner "local-exec" {
    command = "kubectl get configmap argocd-cm -n argocd -o yaml > argocd-cm.yml"
  }
}

resource "local_file" "argocd_cm_file" {
  filename = "argocd-cm.yml"
  depends_on = [null_resource.get_argocd_cm]
  content  = <<-EOT
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: argocd-cm
      namespace: argocd
    data:
      accounts.argocd_unnati: apiKey, login
    EOT
}
resource "null_resource" "argocd_cm_file" {
  depends_on = [local_file.argocd_cm_file]

  provisioner "local-exec" {
    command = "kubectl apply -f argocd-cm.yml"
  }
}
